<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Thanh to√°n</title>
</head>
<body>

<h2>üí≥ Thanh to√°n booking</h2>

<p><strong>M√£ booking:</strong> <span id="bookingId"></span></p>
<p><strong>S·ªë ti·ªÅn:</strong> 300.000 VND</p>

<button onclick="pay()">Thanh to√°n</button>

<p id="result"></p>

<script>
const bookingId = localStorage.getItem("lastBookingId");

if (!bookingId) {
    alert("Kh√¥ng t√¨m th·∫•y booking!");
    window.location.href = "booking.html";
}

document.getElementById("bookingId").innerText = bookingId;

function pay() {
    fetch("https://ominous-trout-v67rqxvv9j4v2w7rr-8084.app.github.dev/payments", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            bookingId: bookingId,
            amount: 300000
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === "SUCCESS") {
    document.getElementById("result").innerText =
        "‚úÖ Thanh to√°n th√†nh c√¥ng! ƒêang chuy·ªÉn v·ªÅ l·ªãch s·ª≠...";

    // X√≥a booking ƒëang thanh to√°n
    localStorage.removeItem("lastBookingId");

    // T·ª± ƒë·ªông quay v·ªÅ l·ªãch s·ª≠
    setTimeout(() => {
        window.location.href = "history.html";
    }, 1500);
        } else {
            document.getElementById("result").innerText =
                "‚ùå Thanh to√°n th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i!";
        }
    })
    .catch(err => {
        console.error(err);
        alert("L·ªói thanh to√°n");
    });
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thanh to√°n</title>

<style>
/* ===== RESET ===== */
* {
  box-sizing: border-box;
  font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
}

body {
  margin: 0;
  min-height: 100vh;
  background: linear-gradient(135deg, #6f7f80, #3f8f98);
  display: flex;
  justify-content: center;
  align-items: center;
  color: #1f1f1f;
}

/* ===== CARD ===== */
.payment-card {
  background: white;
  width: 420px;
  padding: 36px 34px 42px;
  border-radius: 22px;
  text-align: center;
  box-shadow: 0 30px 70px rgba(0,0,0,0.25);
  position: relative;
}

/* ===== TITLE ===== */
.payment-card h1 {
  margin: 0 0 10px;
  font-size: 26px;
}

.sub {
  color: #6b6b6b;
  margin-bottom: 26px;
}

/* ===== INFO ===== */
.info {
  background: #f6f7f8;
  border-radius: 14px;
  padding: 18px;
  margin-bottom: 26px;
  text-align: left;
}

.info p {
  margin: 6px 0;
  font-size: 15px;
}

.amount {
  font-size: 20px;
  font-weight: 700;
  margin-top: 10px;
}

/* ===== PAY BUTTON ===== */
.pay-btn {
  width: 100%;
  padding: 14px;
  border-radius: 999px;
  border: none;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  color: white;
  background: linear-gradient(135deg, #4f9da6, #357d84);
  box-shadow: 0 10px 24px rgba(79,157,166,0.45);
  transition: transform 0.2s, box-shadow 0.2s;
}

.pay-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 14px 30px rgba(79,157,166,0.55);
}

/* ===== SUCCESS OVERLAY ===== */
.success {
  position: absolute;
  inset: 0;
  background: white;
  border-radius: 22px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  opacity: 0;
  pointer-events: none;
}

.success.show {
  animation: fadeIn 0.4s ease forwards;
}

.check {
  width: 90px;
  height: 90px;
  border-radius: 50%;
  background: linear-gradient(135deg, #4f9da6, #2f7f86);
  display: flex;
  justify-content: center;
  align-items: center;
  color: white;
  font-size: 44px;
  margin-bottom: 18px;
  animation: pop 0.6s ease forwards;
}

.success p {
  font-size: 16px;
  color: #555;
}

/* ===== ANIMATION ===== */
@keyframes pop {
  0% { transform: scale(0.2); opacity: 0; }
  70% { transform: scale(1.15); }
  100% { transform: scale(1); opacity: 1; }
}

@keyframes fadeIn {
  to { opacity: 1; pointer-events: all; }
}
/* ===== SLIDE TO PAY ===== */
.slide-pay {
  position: relative;
  width: 100%;
  height: 54px;
  background: #e6ecec;
  border-radius: 999px;
  overflow: hidden;
  user-select: none;
}
/* PH·∫¶N M√ÄU CH·∫†Y */
.slide-fill {
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  width: 0;
  background: linear-gradient(
    135deg,
    #3f8f97,
    #2f6f74
  );
  transition: width 0.1s;
  overflow: visible;

}


.slide-text {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #5f6f70;
  font-size: 15px;
  font-weight: 500;
  transition: opacity 0.1s;
}

.slide-handle {
  position: absolute;
  top: 4px;
  left: 4px;
  width: 46px;
  height: 46px;
  border-radius: 50%;
  background: linear-gradient(135deg, #4f9da6, #2f7f86);
  color: white;
  font-size: 26px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 8px 18px rgba(79,157,166,0.5);
  transition: background 0.3s;
}

/* ===== WAVE EFFECT ===== */
.wave {
  position: absolute;
  right: -26px;
  top: -30%;
  width: 52px;
  height: 160%;
  background: rgba(255,255,255,0.55);
  filter: blur(6px);
  border-radius: 50%;
  pointer-events: none;

  animation: waveMove 1.6s ease-in-out infinite;
  transform-origin: center;
  transform: scaleY(var(--scale, 1));
}


/* ===== 2 L·ªöP S√ìNG ===== */
.wave-main {
  background: rgba(255,255,255,0.55);
  animation-duration: 1.6s;
}

.wave-sub {
  background: rgba(255,255,255,0.35);
  filter: blur(10px);
  animation-duration: 2.4s;
  top: -40%;
}

/* ===== GI·ªåT N∆Ø·ªöC ===== */
.drop {
  position: absolute;
  right: -10px;
  top: 50%;
  width: 6px;
  height: 6px;
  background: rgba(255,255,255,0.8);
  border-radius: 50%;
  opacity: 0;
  pointer-events: none;
  transform: translateY(0) scale(1);
}

.drop.active {
  animation: splash 0.6s ease-out forwards;
}

/* üí• GI·ªåT N∆Ø·ªöC B·∫ÆN TUNG */
@keyframes splashBurst {
  0% {
    opacity: 1;
    transform: translate(0, 0) scale(1);
  }
  100% {
    opacity: 0;
    transform: translate(var(--x), var(--y)) scale(0.2);
  }
}

.drop.burst {
  animation: splashBurst 0.8s ease-out forwards;
}


@keyframes waveMove {
  0% {
    margin-right: 0;
  }
  50% {
    margin-right: 8px;
  }
  100% {
    margin-right: 0;
  }
}



</style>
</head>

<body>

<div class="payment-card">

  <h1>üí≥ Thanh to√°n</h1>
  <p class="sub">Ho√†n t·∫•t thanh to√°n ƒë·ªÉ x√°c nh·∫≠n booking</p>

  <div class="info">
    <p><strong>M√£ booking:</strong> <span id="bookingId"></span></p>
    <p class="amount">300.000 VND</p>
  </div>

 <div class="slide-pay" id="slidePay">

  <div class="slide-fill" id="slideFill">
    <div class="wave wave-main"></div>
    <div class="wave wave-sub"></div>

    <!-- üíß gi·ªçt n∆∞·ªõc -->
    <span class="drop"></span>
    <span class="drop"></span>
    <span class="drop"></span>
  </div>

  <div class="slide-text">K√©o ƒë·ªÉ x√°c nh·∫≠n thanh to√°n</div>
  <div class="slide-handle" id="slideHandle">‚Ä∫</div>

</div>


  <!-- SUCCESS -->
  <div class="success" id="successBox">
    <div class="check">‚úì</div>
    <p>Thanh to√°n th√†nh c√¥ng<br>ƒêang chuy·ªÉn t·ªõi l·ªãch s·ª≠ ƒë·∫∑t ph√≤ng‚Ä¶</p>
  </div>

</div>

<script>
const bookingId = localStorage.getItem("lastBookingId");

if (!bookingId) {
  alert("Kh√¥ng t√¨m th·∫•y booking!");
  location.href = "booking.html";
}

document.getElementById("bookingId").innerText = bookingId;

function pay() {
  fetch("https://ominous-trout-v67rqxvv9j4v2w7rr-8084.app.github.dev/payments", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      bookingId: bookingId,
      amount: 300000
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === "SUCCESS") {
      document.getElementById("successBox").classList.add("show");
      localStorage.removeItem("lastBookingId");

      setTimeout(() => {
        location.href = "history.html";
      }, 5000);
    } else {
      alert("‚ùå Thanh to√°n th·∫•t b·∫°i");
    }
  })
  .catch(() => alert("L·ªói thanh to√°n"));
}
</script>

<script>
const slider = document.getElementById("slidePay");
const handle = document.getElementById("slideHandle");
const fill = document.getElementById("slideFill");
const text = slider.querySelector(".slide-text");

let isDragging = false;
let startX = 0;

handle.addEventListener("mousedown", startDrag);
document.addEventListener("mousemove", drag);
document.addEventListener("mouseup", endDrag);

handle.addEventListener("touchstart", startDrag);
document.addEventListener("touchmove", drag);
document.addEventListener("touchend", endDrag);

function startDrag(e) {
  isDragging = true;
  startX = e.touches ? e.touches[0].clientX : e.clientX;
}

function drag(e) {
  if (!isDragging) return;

  const x = e.touches ? e.touches[0].clientX : e.clientX;
  const delta = x - startX;
  const max = slider.offsetWidth - handle.offsetWidth - 8;

  let left = Math.min(Math.max(4, delta), max);

  handle.style.left = left + "px";

  const fillWidth = left + handle.offsetWidth / 2;
  fill.style.width = fillWidth + "px";

  // üåä wave ph·∫£n ·ª©ng theo t·ªëc ƒë·ªô k√©o
  const waves = fill.querySelectorAll(".wave");
const speed = Math.min(Math.abs(delta) / 10, 8);

waves.forEach(wave => {
  wave.style.setProperty("--scale", 1 + speed / 12);
});

/* üíß t·∫°o gi·ªçt n∆∞·ªõc khi k√©o nhanh */
if (speed > 5) {
  const drops = fill.querySelectorAll(".drop");
  const drop = drops[Math.floor(Math.random() * drops.length)];
  drop.classList.remove("active");
  void drop.offsetWidth; // reset animation
  drop.classList.add("active");
}

  if (left > max * 0.5) {
    text.style.opacity = "0";
  }
}


function endDrag() {
  if (!isDragging) return;
  isDragging = false;

  const max = slider.offsetWidth - handle.offsetWidth - 8;
  const current = parseInt(handle.style.left) || 0;

  if (current >= max * 0.9) {
    handle.style.left = max + "px";
    fill.style.width = "100%";
    confirmPayment();
  } else {
    handle.style.left = "4px";
    fill.style.width = "0";
    text.style.opacity = "1";
  }
}

function splashBurstEffect() {
  const drops = fill.querySelectorAll(".drop");

  drops.forEach(drop => {
    const angle = Math.random() * Math.PI * 2;
    const distance = 20 + Math.random() * 30;

    const x = Math.cos(angle) * distance;
    const y = Math.sin(angle) * distance;

    drop.style.setProperty("--x", x + "px");
    drop.style.setProperty("--y", y + "px");

    drop.classList.remove("burst");
    void drop.offsetWidth; // reset animation
    drop.classList.add("burst");
  });
}

function confirmPayment() {
  // kh√≥a k√©o
  handle.style.pointerEvents = "none";

  // fill full
  fill.style.transition = "width 0.3s ease";
  fill.style.width = "100%";

  // üí• gi·ªçt n∆∞·ªõc b·∫Øn tung
  splashBurstEffect();

  // ‚ùå B·ªé TR·∫†NG TH√ÅI CH·ªú
  text.style.opacity = "0";

  // ‚úÖ THANH TO√ÅN NGAY
  pay();
}

</script>


</body>
</html>

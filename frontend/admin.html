<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin | Phenikaa Hotel</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif}
body{background:#f4f6f9;color:#1a1a1a}
.header{height:64px;background:#000;color:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 24px}
.header .logo{font-size:20px;font-weight:800;letter-spacing:1px}
.header .user{display:flex;align-items:center;gap:12px;font-size:14px}
.header button{padding:6px 14px;border-radius:6px;border:none;background:#fff;color:#000;font-weight:600;cursor:pointer}
.wrapper{display:flex;min-height:calc(100vh - 64px)}
.sidebar{width:240px;background:#fff;border-right:1px solid #e5e7eb;padding:20px}
.sidebar a{display:flex;align-items:center;gap:10px;padding:12px 14px;margin-bottom:8px;border-radius:10px;text-decoration:none;color:#374151;font-weight:600;cursor:pointer}
.sidebar a:hover{background:#f3f4f6}
.sidebar a.active{background:#000;color:#fff}
.content{flex:1;padding:32px}
.page-title{font-size:26px;font-weight:800;margin-bottom:24px}
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:24px}
.stat{background:#fff;padding:22px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
.stat span{font-size:13px;color:#6b7280}
.stat h2{margin-top:8px;font-size:30px;font-weight:800}
.card{background:#fff;border-radius:16px;padding:22px;margin-top:24px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{padding:14px;border-bottom:1px solid #e5e7eb;text-align:left}
th{color:#6b7280;font-weight:700}
.badge{padding:4px 12px;border-radius:999px;font-size:12px;font-weight:700}
.pending{background:#fff4e5;color:#a35b00}
.approved{background:#e8f7ee;color:#1e824c}
.canceled{background:#fdecea;color:#b91c1c}
.btn{padding:7px 14px;border-radius:6px;font-size:13px;cursor:pointer}
.btn-primary{background:#000;color:#fff;border:none}
.btn-outline{background:#fff;border:1px solid #000}
@media(max-width:900px){.sidebar{display:none}}
</style>
</head>

<body>

<div class="header">
  <div class="logo">PHENIKAA ADMIN</div>
  <div class="user">üëã Admin <button onclick="logout()">ƒêƒÉng xu·∫•t</button></div>
</div>

<div class="wrapper">
<aside class="sidebar">
  <a class="active" onclick="show('dashboard',this)">üìä Dashboard</a>
  <a onclick="show('bookings',this)">üõé Booking</a>
  <a onclick="show('rooms',this)">üè® Ph√≤ng</a>
  <a onclick="show('users',this)">üë§ Ng∆∞·ªùi d√πng</a>
</aside>

<main class="content">

<section id="dashboard">
  <div class="page-title">T·ªïng quan</div>
  <div class="stats">
    <div class="stat"><span>Ph√≤ng</span><h2 id="statRooms">0</h2></div>
    <div class="stat"><span>Booking</span><h2 id="statBookings">0</h2></div>
    <div class="stat"><span>Ng∆∞·ªùi d√πng</span><h2 id="statUsers">0</h2></div>

    <div class="stat">
  <span>Doanh thu</span>
  <h2 id="statRevenue">0 ƒë</h2>
</div>

  </div>
</section>

<section id="bookings" style="display:none">
  <div class="page-title">Qu·∫£n l√Ω Booking</div>
  <div class="card">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Email</th>
          <th>Room</th>
          <th>Ng√†y</th>
          <th>Tr·∫°ng th√°i</th>
          <th>H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody id="bookingTable"></tbody>
    </table>
  </div>
</section>

<section id="rooms" style="display:none">
  <div class="page-title">Qu·∫£n l√Ω Ph√≤ng</div>
  <div class="card">
    <table>
      <thead>
        <tr><th>ID</th><th>T√™n</th><th>S·ª©c ch·ª©a</th><th>Gi√°</th><th></th></tr>
      </thead>
      <tbody id="roomTable"></tbody>
    </table>
  </div>
</section>

<section id="users" style="display:none">
  <div class="page-title">Qu·∫£n l√Ω Ng∆∞·ªùi d√πng</div>
  <div class="card">
    <table>
      <thead>
        <tr><th>Username</th><th>Email</th><th>Role</th></tr>
      </thead>
      <tbody id="userBody"></tbody>
    </table>
  </div>
</section>

</main>
</div>

<script>
const BASE="https://ominous-trout-v67rqxvv9j4v2w7rr-8088.app.github.dev/api";

function show(id,el){
  document.querySelectorAll("section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
  document.querySelectorAll(".sidebar a").forEach(a=>a.classList.remove("active"));
  el.classList.add("active");
  if(id==="dashboard")loadDashboard();
  if(id==="bookings")loadBookings();
  if(id==="rooms")loadRooms();
  if(id==="users")loadUsers();
}

async function loadDashboard(){
  const [rooms, bookings, users, revenue] = await Promise.all([
    fetch(BASE+"/rooms").then(r=>r.json()),
    fetch(BASE+"/bookings").then(r=>r.json()),
    fetch(BASE+"/users").then(r=>r.json()),
    fetch(BASE+"/payments/revenue/total").then(r=>r.json())
  ]);

  statRooms.innerText = rooms.length;
  statBookings.innerText = bookings.length;
  statUsers.innerText = users.length;
  statRevenue.innerText = revenue.toLocaleString() + " ƒë";
}

function loadBookings(){
  fetch(BASE+"/bookings/admin").then(r=>r.json()).then(data=>{
    bookingTable.innerHTML="";
    data.forEach(b=>{
      const cls=b.status==="CONFIRMED"?"approved":b.status==="CANCELLED"?"canceled":"pending";
      const act=b.status==="PENDING_PAYMENT"
        ?`<button class="btn btn-primary" onclick="confirmBooking(${b.id})">Duy·ªát</button>
           <button class="btn btn-outline" onclick="cancelBooking(${b.id})">Hu·ª∑</button>`
        :"‚Äî";
      bookingTable.innerHTML+=`
        <tr>
          <td>${b.id}</td>
          <td>${b.userEmail}</td>
          <td>${b.roomName} (${b.roomPrice.toLocaleString()} ƒë)</td>
          <td>${b.checkIn} ‚Üí ${b.checkOut}</td>
          <td><span class="badge ${cls}">${b.status}</span></td>
          <td>${act}</td>
        </tr>`;
    });
  });
}

function confirmBooking(id){
  fetch(`${BASE}/bookings/${id}/confirm`,{method:"PUT"}).then(loadBookings);
}
function cancelBooking(id){
  fetch(`${BASE}/bookings/${id}/cancel`,{method:"PUT"}).then(loadBookings);
}

function loadRooms(){
  fetch(BASE+"/rooms").then(r=>r.json()).then(data=>{
    roomTable.innerHTML="";
    data.forEach(r=>{
      roomTable.innerHTML+=`
        <tr>
          <td>${r.id}</td>
          <td>${r.name}</td>
          <td>${r.capacity}</td>
          <td>${r.price.toLocaleString()} ƒë</td>
          <td><button class="btn btn-outline" disabled>S·ª≠a</button></td>
        </tr>`;
    });
  });
}

function loadUsers(){
  fetch(BASE+"/users").then(r=>r.json()).then(data=>{
    userBody.innerHTML="";
    data.forEach(u=>{
      userBody.innerHTML+=`
        <tr>
          <td>${u.username}</td>
          <td>${u.email}</td>
          <td>${u.role}</td>
        </tr>`;
    });
  });
}

function logout(){
  localStorage.clear();
  location.href="admin-login.html";
}

loadDashboard();
</script>

</body>
</html>
